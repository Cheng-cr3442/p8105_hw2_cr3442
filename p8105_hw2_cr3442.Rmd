---
title: "p8105_hw2_cr3442"
author: "Cheng Rao"
date: "2024-10-02"
output: github_document
---

```{r global_options, include = FALSE}
knitr::opts_chunk$set(warning = FALSE,message = FALSE,tidy = TRUE)
```

```{r setup, include = FALSE}
library(tidyverse)
library(readxl)
```

# Problem 1

First, let us read and clean the NYC Transit data.

```{r nyc_data}
#Read and clean the NYC Transit data
nyc_trans_df = 
  read_csv(
    "./data/NYC_Transit_Subway_Entrance_And_Exit_Data.csv",
  ) %>%
  janitor::clean_names() %>% 
  
#Retain line, station, name, station latitude / longitude, routes served, entry, vending, entrance type, and ADA compliance
  select(
    .,line, station_name, station_latitude, station_longitude, starts_with("route"), entry, vending, entrance_type, ada
    )  %>%
  
#Convert the entry variable from character to a logical variable
  mutate(
    entry = recode(entry, "YES" = TRUE, "NO" = FALSE),
    vending = recode(vending, "YES" = TRUE, "NO" = FALSE),
      )
  
#check if the variables are right or not
str(nyc_trans_df)
```

In the above process, we loaded the NYC Transit dataset and named it `nyc_trans_df`. There are `r nrow(nyc_trans_df)` rows and `r ncol(nyc_trans_df)` columns in the dataset `nyc_trans_df`. And we cleaned the names of columns, selected the desired variables and changed two character variables to logical variables ---- `entry` and `vending`. The dataset contained the following variables: `r colnames( nyc_trans_df)`. These data are not tidy enough.

Then we are going to answer the questions of Problem 1.

```{r using_these_data, include = FALSE}
#Use distinct() based on line and station_name to find number of stations
station_distinct =
  distinct(
    nyc_trans_df, line, station_name, .keep_all = TRUE
    )

#Filtering ADA with filter()
ada_compliant = 
  filter(
    station_distinct, ada == TRUE
  )

```


```{r using_data_prop, include = FALSE}
#Filter subway stations that without ticket vending machines but allow entry
n1 = 
  filter(
    nyc_trans_df, vending == FALSE & entry == TRUE
  ) %>% 
  nrow()

#Filter subway stations without ticket vending machines
n2 = 
  filter(
    nyc_trans_df, vending == FALSE
  ) %>% 
  nrow()

```

At last reformat the data.

```{r reformat_data}
#Reformat
dist_route_df = station_distinct %>%
#Convert
mutate_at(vars(route8:route11), as.character) %>% 
  pivot_longer(
    route1:route11,
    names_to = "route",
    values_to = "train")

#Output the front part of the reformatted data frame
head(dist_route_df)
```


* **Answers:**
- 1.There are `r nrow(station_distinct)` stations in NYC.
- 2.There are `r nrow(ada_compliant)` ADA compliant.
- 3.The proportion of station entrances / exits without vending allow entrance is `r n1/n2`.
- 4.There are `r nrow(filter(dist_route_df, train == "A"))` stations serving the A train.
- 5.The number of distinct stations serving the A train and are ADA compliant is `r nrow(filter(dist_route_df, train == "A" & ada == "TRUE"))`.

  

